<!doctype html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>G.E.M. | 能量聚合场</title>
  <style>
    :root { --gem-red: #ff2d55; --glow-strong: rgba(255, 45, 85, 0.8); }
    * { box-sizing: border-box; touch-action: none; user-select: none; }
    body {
      margin: 0; height: 100vh; background: #000;
      display: flex; align-items: center; justify-content: center;
      overflow: hidden; perspective: 1000px;
      font-family: -apple-system, "PingFang SC", sans-serif;
      cursor: none; /* 隐藏默认鼠标，配合自定义光标 */
    }

    /* === 开场星际隧道 === */
    #preloader {
      position: fixed; inset: 0; z-index: 9999;
      background: linear-gradient(to bottom, #000 0%, #0a0a1a 100%);
      display: flex; align-items: center; justify-content: center;
      overflow: hidden;
      animation: fadeOutPreloader 2s ease-out 3s forwards;
    }
    .tunnel-star {
      position: absolute; background: white; border-radius: 50%;
      opacity: 0; animation: starTravel 3s linear infinite;
    }
    @keyframes starTravel {
      0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
      20% { opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
    }
    @keyframes fadeOutPreloader {
      to { opacity: 0; visibility: hidden; }
    }
    
    /* === 主体背景与粒子 === */
    .bg { position: fixed; inset: 0; z-index: 1; background: url('gem-h5/assets/1.jpg') center/cover; filter: blur(100px) brightness(0.08); }
    #canvas-main { position: fixed; inset: 0; z-index: 5; } /* 主粒子场 */
    #canvas-pulse { position: fixed; inset: 0; z-index: 6; } /* 能量脉冲 */

    /* === 能量核心 G.E.M. === */
    .energy-core {
      position: absolute; z-index: 10; font-size: 4rem; font-weight: 100;
      letter-spacing: 20px; color: #fff; text-shadow: 0 0 40px var(--glow-strong);
      animation: pulseCore 3s infinite alternate; /* 核心呼吸动效 */
      pointer-events: none;
    }
    @keyframes pulseCore {
      from { transform: scale(1); text-shadow: 0 0 20px var(--gem-red); }
      to { transform: scale(1.05); text-shadow: 0 0 50px var(--gem-red), 0 0 80px rgba(255,45,85,0.4); }
    }
    
    /* === 动态文案 (星语) === */
    #star-quote {
      position: absolute; top: 25%; z-index: 10; color: #eee; font-size: 0.95rem;
      letter-spacing: 4px; text-shadow: 0 0 10px rgba(255,255,255,0.3);
      transition: opacity 1.5s, transform 1.5s; opacity: 0; pointer-events: none;
    }

    /* === 相册引力环 === */
    #photo-ring {
      position: absolute; top: 50%; left: 50%; transform-style: preserve-3d;
      transform: rotateX(-15deg); /* 倾斜视角 */
      animation: rotateRing 60s linear infinite;
    }
    .photo-item {
      position: absolute; width: 150px; height: 200px;
      border-radius: 6px; overflow: hidden; transform-style: preserve-3d;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.1);
      transition: all 0.5s ease-out;
    }
    .photo-item img { width: 100%; height: 100%; object-fit: cover; }

    /* === 播放器与自定义光标 === */
    .player-control {
      position: fixed; bottom: 30px; right: 30px; z-index: 100;
      width: 80px; height: 80px; border-radius: 50%;
      background: rgba(255, 45, 85, 0.2); backdrop-filter: blur(10px);
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 0 20px rgba(255,45,85,0.3);
      cursor: pointer; transition: all 0.3s ease;
    }
    .player-icon { font-size: 3rem; color: #fff; text-shadow: 0 0 10px #fff; }
    .player-control.paused { background: rgba(0,0,0,0.5); box-shadow: none; }

    /* 自定义光标 */
    #custom-cursor {
      position: fixed; width: 30px; height: 30px; background: radial-gradient(circle, var(--gem-red) 0%, transparent 70%);
      border-radius: 50%; pointer-events: none; z-index: 999; opacity: 0.7;
      transform: translate(-50%, -50%); transition: transform 0.1s ease-out;
    }
    
    /* 媒体查询 */
    @media screen and (max-width: 768px) {
      .energy-core { font-size: 2.2rem; letter-spacing: 12px; }
      #star-quote { top: 20%; font-size: 0.8rem; letter-spacing: 2px; }
      .photo-item { width: 90px; height: 120px; }
      .player-control { bottom: calc(20px + env(safe-area-inset-bottom)); right: 20px; width: 60px; height: 60px; }
      .player-icon { font-size: 2rem; }
      #custom-cursor { display: none; } /* 手机端隐藏自定义光标 */
    }

    @keyframes rotateRing {
      from { transform: rotateY(0deg) rotateX(-15deg); }
      to { transform: rotateY(360deg) rotateX(-15deg); }
    }
  </style>
</head>
<body onmousemove="updateCursor(event)">
  <div id="preloader"></div>

  <div class="bg"></div>
  <canvas id="canvas-main"></canvas> <canvas id="canvas-pulse"></canvas> <audio id="audio-player" loop src="gem-h5/assets/bgm.MP3"></audio>

  <div class="energy-core">G.E.M.</div>
  <div id="star-quote">聆听 能量之源</div>

  <div id="photo-ring"></div>

  <div class="player-control" id="music-player">
    <span class="player-icon">▶</span>
  </div>

  <div id="custom-cursor"></div>

  <script>
    const audio = document.getElementById('audio-player');
    const playerControl = document.getElementById('music-player');
    const playerIcon = playerControl.querySelector('.player-icon');
    const starQuote = document.getElementById('star-quote');
    const photoRing = document.getElementById('photo-ring');
    const customCursor = document.getElementById('custom-cursor');
    const preloader = document.getElementById('preloader');

    // 预加载器星辰生成
    function createPreloaderStars() {
        for (let i = 0; i < 50; i++) {
            const star = document.createElement('div');
            star.className = 'tunnel-star';
            star.style.left = `${Math.random() * 100}%`;
            star.style.top = `${Math.random() * 100}%`;
            star.style.width = `${Math.random() * 3 + 1}px`;
            star.style.height = star.style.width;
            star.style.animationDelay = `${Math.random() * 3}s`;
            preloader.appendChild(star);
        }
    }
    createPreloaderStars();

    // 自定义光标更新
    function updateCursor(event) {
        customCursor.style.left = `${event.clientX}px`;
        customCursor.style.top = `${event.clientY}px`;
    }

    // 智能文案系统
    const quotes = [
        "聆听 能量之源",
        "音符聚合，星光为你闪耀",
        "在她的宇宙，感受无限可能",
        "每一次心跳，都是旋律的引力",
        "你的存在，点亮整个星系",
        "FROM GLORY TO GLORY"
    ];
    let quoteIndex = 0;
    function cycleQuotes() {
        setInterval(() => {
            if (!audio.paused) {
                starQuote.style.opacity = 0;
                starQuote.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    quoteIndex = (quoteIndex + 1) % quotes.length;
                    starQuote.innerText = quotes[quoteIndex];
                    starQuote.style.opacity = 1;
                    starQuote.style.transform = 'translateY(0)';
                }, 1500); // 过渡时间匹配CSS
            }
        }, 6000); // 每6秒切换
    }

    // 音乐播放控制
    playerControl.onclick = (e) => {
        e.stopPropagation(); // 阻止事件冒泡到 body
        if (audio.paused) {
            audio.play().then(() => {
                playerControl.classList.remove('paused');
                playerIcon.innerText = '⏸';
                startPulseEffect(); // 播放时启动脉冲
                starQuote.style.opacity = 1; // 播放后显示文案
                cycleQuotes(); // 启动文案轮播
            });
        } else {
            audio.pause();
            playerControl.classList.add('paused');
            playerIcon.innerText = '▶';
            stopPulseEffect(); // 暂停时停止脉冲
        }
    };

    // 自动播放与初始化
    window.addEventListener('load', () => {
        // 尝试自动播放（静音或未静音）
        audio.muted = true; // 首次加载先静音
        audio.play().then(() => {
            audio.muted = false; // 播放成功再解除静音
            playerControl.classList.remove('paused');
            playerIcon.innerText = '⏸';
            startPulseEffect();
            starQuote.style.opacity = 1;
            cycleQuotes();
        }).catch(() => {
            // 如果自动播放失败，提示用户点击
            audio.muted = false; // 确保下次点击有声音
            playerControl.classList.add('paused');
            playerIcon.innerText = '▶';
        });

        // 微信环境补丁
        document.addEventListener("WeixinJSBridgeReady", () => {
            audio.play().then(() => {
                playerControl.classList.remove('paused');
                playerIcon.innerText = '⏸';
                startPulseEffect();
                starQuote.style.opacity = 1;
                cycleQuotes();
            }).catch(e => console.log("Weixin AutoPlay Blocked:", e));
        }, false);
    });

    // === 相册引力环 ===
    const images = ["1.jpg", "2.jpg", "3.jpg", "4.jpg", "5.jpg", "6.jpg"];
    const itemWidth = 150; // 图片宽度
    const itemHeight = 200; // 图片高度
    const ringRadius = 400; // 环形半径
    const numItems = images.length;
    
    // 生成图片元素
    images.forEach((name, i) => {
        const item = document.createElement('div');
        item.className = 'photo-item';
        // 计算每个图片在环上的位置
        const angle = i * (360 / numItems);
        item.style.transform = `rotateY(${angle}deg) translateZ(${ringRadius}px) translateX(-50%) translateY(-50%)`;
        item.style.left = '50%';
        item.style.top = '50%';
        item.innerHTML = `<img src="gem-h5/assets/${name}" onerror="this.src='https://via.placeholder.com/150x200/000/fff?text=G.E.M.'">`;
        photoRing.appendChild(item);
    });

    // === 主粒子场 Canvas ===
    const canvasMain = document.getElementById('canvas-main');
    const ctxMain = canvasMain.getContext('2d');
    let particlesMain = [];
    const mainParticleCount = window.innerWidth < 768 ? 60 : 150; // 手机端粒子少点
    const particleDistance = 150; // 连线距离

    class MainParticle {
      constructor() {
        this.x = Math.random() * canvasMain.width;
        this.y = Math.random() * canvasMain.height;
        this.vx = (Math.random() - 0.5) * 0.5;
        this.vy = (Math.random() - 0.5) * 0.5;
        this.size = Math.random() * 2 + 0.5;
        this.opacity = Math.random() * 0.8 + 0.2;
      }
      draw() {
        ctxMain.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
        ctxMain.beginPath();
        ctxMain.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctxMain.fill();
      }
      update() {
        this.x += this.vx;
        this.y += this.vy;
        if (this.x < 0 || this.x > canvasMain.width) this.vx *= -1;
        if (this.y < 0 || this.y > canvasMain.height) this.vy *= -1;
        this.draw();
      }
    }

    function initMainParticles() {
      canvasMain.width = window.innerWidth;
      canvasMain.height = window.innerHeight;
      particlesMain = [];
      for (let i = 0; i < mainParticleCount; i++) particlesMain.push(new MainParticle());
    }

    function animateMainParticles() {
      ctxMain.clearRect(0, 0, canvasMain.width, canvasMain.height);
      particlesMain.forEach(p => p.update());
      // 粒子连线 (北斗星效果)
      for (let a = 0; a < particlesMain.length; a++) {
        for (let b = a; b < particlesMain.length; b++) {
          let dist = Math.hypot(particlesMain[a].x - particlesMain[b].x, particlesMain[a].y - particlesMain[b].y);
          if (dist < particleDistance) {
            ctxMain.strokeStyle = `rgba(255, 45, 85, ${1 - dist / particleDistance})`;
            ctxMain.lineWidth = 0.5;
            ctxMain.beginPath();
            ctxMain.moveTo(particlesMain[a].x, particlesMain[a].y);
            ctxMain.lineTo(particlesMain[b].x, particlesMain[b].y);
            ctxMain.stroke();
          }
        }
      }
      requestAnimationFrame(animateMainParticles);
    }
    initMainParticles();
    animateMainParticles();
    window.addEventListener('resize', initMainParticles);

    // === 能量脉冲 Canvas (随音乐跳动) ===
    const canvasPulse = document.getElementById('canvas-pulse');
    const ctxPulse = canvasPulse.getContext('2d');
    let animationFrameId = null;

    function initPulseCanvas() {
        canvasPulse.width = window.innerWidth;
        canvasPulse.height = window.innerHeight;
    }

    function drawPulseEffect() {
        if (audio.paused) return; // 暂停时不绘制脉冲

        ctxPulse.clearRect(0, 0, canvasPulse.width, canvasPulse.height);
        const centerX = canvasPulse.width / 2;
        const centerY = canvasPulse.height / 2;
        const baseRadius = window.innerWidth < 768 ? 50 : 80;

        // 模拟音频振幅，让脉冲跳动
        const amplitude = (audio.paused ? 0 : 0.5 + Math.sin(Date.now() * 0.005) * 0.5) * 20;

        for (let i = 0; i < 5; i++) {
            const radius = baseRadius + i * 15 + amplitude;
            const alpha = 0.5 - i * 0.1;
            if (alpha <= 0) continue;

            ctxPulse.strokeStyle = `rgba(255, 45, 85, ${alpha})`;
            ctxPulse.lineWidth = 2 + i;
            ctxPulse.beginPath();
            ctxPulse.arc(centerX, centerY, radius, 0, Math.PI * 2);
            ctxPulse.stroke();
        }
        animationFrameId = requestAnimationFrame(drawPulseEffect);
    }

    function startPulseEffect() {
        if (!animationFrameId) {
            initPulseCanvas();
            drawPulseEffect();
        }
    }

    function stopPulseEffect() {
        if (animationFrameId) {
            cancelAnimationFrame(animationFrameId);
            animationFrameId = null;
            ctxPulse.clearRect(0, 0, canvasPulse.width, canvasPulse.height); // 清除画布
        }
    }
    window.addEventListener('resize', initPulseCanvas);
  </script>
</body>
</html>
